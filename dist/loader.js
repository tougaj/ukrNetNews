"use strict";var __awaiter=this&&this.__awaiter||function(e,s,l,a){return new(l=l||Promise)(function(o,t){function r(e){try{i(a.next(e))}catch(e){t(e)}}function n(e){try{i(a.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?o(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,n)}i((a=a.apply(e,s||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const nodeFetch=require("node-fetch"),fs=require("fs"),HttpsProxyAgent=require("https-proxy-agent"),moment=require("moment"),argv=require("yargs").usage("Usage: node ./dist/$0 -p [str]").string(["p"]).alias("p","proxy").nargs("p",1).describe("p","Proxy configuration in format http://login:password@address:port/").help("h").alias("h","help").argv,outputDir="./output",MESSAGES_MAX_COUNT=50,MAX_LENGTH={title:200,description:1e3},proxyAddress=argv.proxy,proxyAgent=proxyAddress?new HttpsProxyAgent(proxyAddress):void 0,messages={},getNews=(e,t=MESSAGES_MAX_COUNT)=>{return e.slice(0,t).map(({Title:e="",Description:t="",DateCreated:o,NewsCount:r,NewsId:n})=>(void 0===messages[n]&&(messages[n]={title:e.substring(0,MAX_LENGTH.title),description:t.substring(0,MAX_LENGTH.description),created:moment(1e3*o).toISOString(),count:r}),n))},loadUkrNetNews=({route:o,longTitle:r})=>__awaiter(void 0,void 0,void 0,function*(){var t=`https://www.ukr.net/news/dat/${o}/0/`;try{return yield nodeFetch(t,{agent:proxyAgent}).then(e=>e.json()).then(e=>{var{tops:t,Title:e}=e;return console.log(`${e} (${o}) loaded`),{route:o,title:e,longTitle:r,tops:getNews(t)}})}catch(e){return console.log(`!!! ERROR !!! ${o} not loaded from url: ${t}`),console.log(e),null}}),loadAllNews=()=>__awaiter(void 0,void 0,void 0,function*(){const e=yield Promise.all([{route:"main",longTitle:"Головні події України та світу"},{route:"politics",longTitle:"Політичні новини країни"},{route:"economics",longTitle:"Економіка та бізнес"},{route:"covid19",longTitle:"Коронавірус COVID-19"},{route:"criminal",longTitle:"Оперативно про надзвичайні події"},{route:"society",longTitle:"Соціальні та культурні події"},{route:"world",longTitle:"Ситуація в світі"},{route:"kyiv",longTitle:"Події в Києві та області"},{route:"crimea",longTitle:"Події в Криму"},{route:"donetsk",longTitle:"Події в Донецьку та області"},{route:"luhansk",longTitle:"Події в Луганську та області"}].map(loadUkrNetNews));var t={created:moment().toISOString(),news:e.filter(e=>null!==e),messages:messages},t=JSON.stringify(t,null,"\t");fs.writeFileSync(`${outputDir}/ukrnet.json`,t),console.log("\nAll routes loaded")});fs.existsSync(outputDir)||fs.mkdirSync(outputDir);try{loadAllNews()}catch(e){console.error(e)}