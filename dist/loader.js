"use strict";var __awaiter=this&&this.__awaiter||function(t,s,c,l){return new(c=c||Promise)(function(o,e){function n(t){try{i(l.next(t))}catch(t){e(t)}}function r(t){try{i(l.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?o(t.value):((e=t.value)instanceof c?e:new c(function(t){t(e)})).then(n,r)}i((l=l.apply(t,s||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const nodeFetch=require("node-fetch"),fs=require("fs"),HttpsProxyAgent=require("https-proxy-agent"),moment=require("moment"),outputDir="./output",MESSAGES_MAX_COUNT=50,MAX_LENGTH={title:200,description:1e3},proxy="http://192.168.0.1:3128",proxyAgent=new HttpsProxyAgent(proxy),getNews=(t,e=MESSAGES_MAX_COUNT)=>{return t.slice(0,e).map(({Title:t,Description:e,DateCreated:o,NewsCount:n})=>({title:t.substring(0,MAX_LENGTH.title),description:e.substring(0,MAX_LENGTH.description),created:moment(1e3*o).toISOString(),count:n}))},loadUkrNetNews=o=>nodeFetch(`https://www.ukr.net/news/dat/${o}/0/`,{agent:proxyAgent}).then(t=>t.json()).then(t=>{var{tops:e,Title:t}=t;return console.log(`${t} (${o}) loaded`),{route:o,title:t,tops:getNews(e)}}),loadAllNews=()=>__awaiter(void 0,void 0,void 0,function*(){var t=yield Promise.all(["main","politics","economics","criminal","world","society","kyiv"].map(loadUkrNetNews)),t={created:moment().toISOString(),news:t},t=JSON.stringify(t,null,"\t");fs.writeFileSync(`${outputDir}/ukrnet.json`,t),console.log("\nAll routes loaded")});fs.existsSync(outputDir)||fs.mkdirSync(outputDir);try{loadAllNews()}catch(t){console.error(t)}